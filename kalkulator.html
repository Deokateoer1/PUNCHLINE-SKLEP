<!DOCTYPE html>
<html lang="pl">

<head>
    <!-- Google Tag Manager -->
    <script>(function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                    new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                    'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-XXXXX');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalkulator KSeF ROI - PunchlineROI</title>
    <style>
        :root {
            --blue-primary: #1E3A8A;
            --blue-light: #3B82F6;
            --green-primary: #16A34A;
            --orange-accent: #F97316;
            --bg-light: #F1F5F9;
            --white: #ffffff;
            --text-main: #0F172A;
            --text-light: #64748b;
            --error: #ef4444;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--bg-light);
            color: var(--text-main);
            line-height: 1.5;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            .container {
                flex-direction: row;
            }
        }

        /* --- SEKCJA LEWA --- */
        .inputs-section {
            flex: 1;
            padding: 30px;
            border-right: 1px solid #e2e8f0;
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--blue-primary);
        }

        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .btn-preset {
            flex: 1;
            padding: 10px;
            border: 2px solid #e2e8f0;
            background: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .btn-preset:hover {
            border-color: var(--blue-light);
        }

        .btn-preset.active {
            border-color: var(--blue-light);
            background-color: #eff6ff;
            color: var(--blue-light);
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-light);
        }

        input[type="number"],
        input[type="email"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        input:focus {
            outline: none;
            border-color: var(--blue-light);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        input.invalid {
            border-color: var(--error);
            background-color: #fef2f2;
        }

        .error-msg {
            color: var(--error);
            font-size: 0.75rem;
            margin-top: 4px;
            display: none;
        }

        /* --- SEKCJA PRAWA --- */
        .results-section {
            flex: 1;
            padding: 30px;
            background-color: #f8fafc;
            display: flex;
            flex-direction: column;
        }

        .result-card {
            background: var(--blue-primary);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            transition: transform 0.15s ease-out;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 10px 0;
            color: #4ade80;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .stat-val {
            font-weight: 700;
            color: var(--blue-primary);
        }

        /* --- HISTORIA --- */
        .history-section {
            margin-bottom: 20px;
        }

        .history-title {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--text-light);
            text-transform: uppercase;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .history-list {
            list-style: none;
            font-size: 0.8rem;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px dashed #e2e8f0;
            color: #475569;
        }

        /* --- CTA --- */
        .cta-box {
            margin-top: auto;
            border-top: 1px solid #e2e8f0;
            padding-top: 20px;
        }

        .privacy-container {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .privacy-container:hover {
            border-color: var(--blue-light);
        }

        .btn-main {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 10px;
            text-align: center;
        }

        .btn-pdf {
            background-color: var(--blue-light);
            color: white;
        }

        .btn-pdf:hover {
            background-color: #2563eb;
            transform: translateY(-1px);
        }

        .btn-order {
            background-color: var(--green-primary);
            color: white;
        }

        .btn-order:hover {
            background-color: #15803d;
            transform: translateY(-1px);
        }

        .btn-main:active {
            transform: translateY(0) scale(0.98);
        }

        #feedback-msg {
            text-align: center;
            font-size: 0.85rem;
            min-height: 1.2rem;
            margin-top: 5px;
        }

        /* --- KONTAKT SECTION --- */
        #kontakt-section {
            max-width: 1000px;
            margin: 40px auto;
            background: white;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            border: 2px solid #eff6ff;
        }

        .kontakt-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #dcfce7;
            color: #166534;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        /* --- FOOTER BRANDING --- */
        footer {
            max-width: 1000px;
            margin: 20px auto 40px;
            padding: 20px;
            text-align: center;
            color: var(--text-light);
            font-size: 0.85rem;
            border-top: 1px solid #e2e8f0;
        }

        .footer-brand {
            color: var(--blue-primary);
            font-weight: 800;
            letter-spacing: -0.5px;
            text-decoration: none;
            font-size: 1rem;
        }

        /* --- MODAL --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background-color: #fff;
            padding: 40px;
            border-radius: 20px;
            width: 100%;
            max-width: 800px;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #64748b;
        }
    </style>
</head>

<body>
    <div class="back-link" style="max-width:900px;margin:0 auto 20px auto;font-size:16px;">
        <a href="/index.html" style="color:#1E3A8A;text-decoration:none;font-weight:500;">‚Üê Wr√≥ƒá do strony g≈Ç√≥wnej</a>
    </div>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-XXXXX" height="0" width="0"
            style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <div class="container">
        <!-- LEWA STRONA: INPUTY -->
        <div class="inputs-section">
            <h1>üìä Kalkulator ROI KSeF</h1>
            <div class="preset-buttons">
                <button type="button" class="btn-preset active" onclick="setPreset('small')" id="btn-small">Ma≈Ça
                    Firma</button>
                <button type="button" class="btn-preset" onclick="setPreset('corp')" id="btn-corp">Biuro /
                    Korpo</button>
            </div>

            <div class="input-group">
                <label for="invoices">Liczba faktur miesiƒôcznie</label>
                <input type="number" id="invoices" value="150" min="1" max="10000" oninput="calculate()">
                <div id="error-invoices" class="error-msg">Wprowad≈∫ od 1 do 10 000</div>
            </div>

            <div class="input-group">
                <label for="cost-per-hour">Koszt roboczogodziny (PLN)</label>
                <input type="number" id="cost-per-hour" value="80" min="30" max="500" oninput="calculate()">
                <div id="error-cost-per-hour" class="error-msg">Wprowad≈∫ od 30 do 500 PLN</div>
            </div>

            <div class="input-group">
                <label for="manual-time">Czas na 1 fakturƒô (minuty)</label>
                <input type="number" id="manual-time" value="12" min="1" max="60" oninput="calculate()">
                <div id="error-manual-time" class="error-msg">Wprowad≈∫ od 1 do 60 min</div>
            </div>

            <div style="margin-top: 30px; padding: 15px; background: #f1f5f9; border-radius: 8px;">
                <p style="font-size: 0.75rem; color: var(--text-light);">
                    üí° Automatyzacja KSeF redukuje czas procesowania o ok. 90% i eliminuje b≈Çƒôdy w 99%.
                </p>
            </div>
        </div>

        <!-- PRAWA STRONA: WYNIKI -->
        <div class="results-section">
            <div class="result-card" id="main-result-card">
                <p>Oszczƒôdno≈õci miesiƒôczne</p>
                <div class="result-value" id="res-monthly-savings">0 PLN</div>
                <p id="res-yearly-savings" style="font-size: 0.9rem; opacity: 0.9;">Rocznie: 0 PLN</p>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <p class="stat-label">Odzyskany czas</p>
                    <p class="stat-val" id="res-time-saved">0h</p>
                </div>
                <div class="stat-box">
                    <p class="stat-label">Efektywno≈õƒá</p>
                    <p class="stat-val">+85%</p>
                </div>
            </div>

            <!-- HISTORIA -->
            <div class="history-section" id="history-container" style="display:none;">
                <div class="history-title">
                    <span>Ostatnie obliczenia</span>
                    <a href="javascript:void(0)" onclick="clearHistory()"
                        style="color: var(--error); text-decoration: none;">wyczy≈õƒá</a>
                </div>
                <ul class="history-list" id="history-list"></ul>
            </div>

            <!-- FORMULARZ NETLIFY -->
            <form name="kalkulator-roi-v2" method="POST" data-netlify="true" id="roi-form" class="cta-box">
                <input type="hidden" name="form-name" value="kalkulator-roi-v2" />
                <input type="hidden" name="lead_oszczednosci_miesieczne" id="hidden-monthly">
                <input type="hidden" name="lead_oszczednosci_roczne" id="hidden-yearly">
                <input type="hidden" name="lead_odzyskany_czas" id="hidden-time">
                <input type="hidden" name="input_faktury" id="hidden-input-invoices">

                <div class="input-group">
                    <label for="email">Tw√≥j E-mail</label>
                    <input type="email" name="email" id="email" placeholder="email@firma.pl" required>
                </div>

                <label class="privacy-container" for="privacy">
                    <input type="checkbox" name="zgoda_marketingowa" id="privacy" required>
                    <span class="privacy-text">
                        Akceptujƒô <a href="javascript:void(0)" onclick="openModal()"
                            style="color: var(--blue-light); text-decoration: underline;">politykƒô prywatno≈õci</a> i
                        chcƒô otrzymaƒá pe≈ÇnƒÖ analizƒô.
                    </span>
                </label>

                <button type="submit" class="btn-main btn-pdf" id="btn-pdf">üì© Wy≈õlij Pe≈Çny Raport PDF</button>
                <button type="button" class="btn-main btn-order" onclick="handleOrder()">üöÄ Zam√≥w wdro≈ºenie
                    KSeF</button>

                <div id="feedback-msg"></div>
            </form>
        </div>
    </div>

    <!-- SEKCJA KONTAKT -->
    <section id="kontakt-section">
        <div class="kontakt-badge">Wdro≈ºenie KSeF Automation</div>
        <h2 style="color: var(--blue-primary); margin-bottom: 10px;">Got√≥w na realne oszczƒôdno≈õci?</h2>
        <p style="color: var(--text-light); margin-bottom: 30px;">Um√≥w siƒô na bezp≈ÇatnƒÖ konsultacjƒô technicznƒÖ, na
            kt√≥rej pomo≈ºemy Ci zaplanowaƒá pe≈ÇnƒÖ automatyzacjƒô obiegu faktur w Twojej firmie.</p>
        <button class="btn-main btn-order" style="max-width: 300px; margin: 0 auto;"
            onclick="window.open('https://calendly.com/punchlineroi', '_blank')">üìÖ Zarezerwuj termin calla</button>
    </section>

    <!-- FOOTER Z MARKƒÑ -->
    <footer>
        <p>Built with ‚ù§Ô∏è by <a href="https://punchlineroi.com" class="footer-brand" target="_blank">PunchlineROI</a></p>
        <p style="margin-top: 10px; opacity: 0.6;">&copy; 2026 PunchlineROI. Building automation that actually works.
        </p>
    </footer>

    <!-- MODAL RODO -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h1>Polityka Prywatno≈õci</h1>
            <p>Szanujemy Twoje dane. Informacje z kalkulatora sƒÖ przetwarzane wy≈ÇƒÖcznie w celu przygotowania
                spersonalizowanej oferty ROI.</p>
            <p>Pe≈ÇnƒÖ tre≈õƒá polityki znajdziesz na stronie: <a href="/polityka-prywatnosci.html" target="_blank"
                    style="color: var(--blue-light);">Polityka Prywatno≈õci</a></p>

            <h2 style="margin-top:20px;">Kluczowe informacje:</h2>
            <ul style="margin-left: 20px; font-size: 0.9rem;">
                <li>Administratorem danych jest PunchlineROI z siedzibƒÖ w Holandii.</li>
                <li>U≈ºywamy Netlify Forms do bezpiecznego przesy≈Çania Twojego zapytania.</li>
                <li>Masz prawo do wglƒÖdu i usuniƒôcia swoich danych w ka≈ºdym momencie.</li>
            </ul>

            <button class="btn-main btn-pdf" onclick="closeModal()" style="margin-top: 30px;">Wr√≥ƒá do
                kalkulatora</button>
        </div>
    </div>

    <script>
        const CONFIG = {
            automationEfficiency: 0.9,
            historyLimit: 3
        };

        // --- TRACKING ENGINE ---
        function trackEvent(eventName, params = {}) {
            console.log(`[GA4 Event] ${eventName}`, params);
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                event: eventName,
                event_params: params
            });
        }

        // --- SAFE STORAGE WRAPPER ---
        const storage = {
            set: (key, val) => {
                try { localStorage.setItem(key, JSON.stringify(val)); } catch (e) { console.warn('Storage unavailable'); }
            },
            get: (key) => {
                try { return JSON.parse(localStorage.getItem(key)); } catch (e) { return null; }
            },
            remove: (key) => {
                try { localStorage.removeItem(key); } catch (e) { }
            }
        };

        // --- LOGIKA KALKULATORA ---
        function calculate() {
            const invCount = parseFloat(document.getElementById('invoices').value) || 0;
            const costHour = parseFloat(document.getElementById('cost-per-hour').value) || 0;
            const timeManual = parseFloat(document.getElementById('manual-time').value) || 0;

            const isInvValid = invCount > 0 && invCount <= 10000;
            const isCostValid = costHour >= 30 && costHour <= 500;
            const isTimeValid = timeManual > 0 && timeManual <= 60;

            toggleError('invoices', isInvValid);
            toggleError('cost-per-hour', isCostValid);
            toggleError('manual-time', isTimeValid);

            if (!isInvValid || !isCostValid || !isTimeValid) return;

            const currentMonthlyCost = (invCount * (timeManual / 60)) * costHour;
            const timeSavedHours = (invCount * (timeManual / 60)) * CONFIG.automationEfficiency;
            const moneySavedMonthly = currentMonthlyCost * CONFIG.automationEfficiency;

            const monthlyStr = Math.round(moneySavedMonthly).toLocaleString() + ' PLN';
            const yearlyStr = Math.round(moneySavedMonthly * 12).toLocaleString() + ' PLN';
            const timeStr = Math.round(timeSavedHours) + 'h';

            // UI
            document.getElementById('res-monthly-savings').innerText = monthlyStr;
            document.getElementById('res-yearly-savings').innerText = 'Rocznie: ' + yearlyStr;
            document.getElementById('res-time-saved').innerText = timeStr;

            // Netlify Hidden Fields
            document.getElementById('hidden-monthly').value = monthlyStr;
            document.getElementById('hidden-yearly').value = yearlyStr;
            document.getElementById('hidden-time').value = timeStr;
            document.getElementById('hidden-input-invoices').value = invCount;

            // PULSE ANIMATION
            const card = document.getElementById('main-result-card');
            card.style.transform = "scale(1.03)";
            setTimeout(() => card.style.transform = "scale(1)", 150);

            saveToHistory(invCount, monthlyStr);
        }

        function toggleError(id, isValid) {
            const input = document.getElementById(id);
            const err = document.getElementById('error-' + id);
            if (!isValid && input.value !== "") {
                input.classList.add('invalid');
                if (err) err.style.display = 'block';
            } else {
                input.classList.remove('invalid');
                if (err) err.style.display = 'none';
            }
        }

        // --- HISTORY LOGIC ---
        function saveToHistory(inv, savings) {
            let history = storage.get('ksef_roi_history') || [];
            if (history.length > 0 && history[0].inv === inv) return;

            const entry = {
                inv,
                savings,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };

            history.unshift(entry);
            history = history.slice(0, CONFIG.historyLimit);
            storage.set('ksef_roi_history', history);
            renderHistory();
        }

        function renderHistory() {
            const history = storage.get('ksef_roi_history') || [];
            const container = document.getElementById('history-container');
            const list = document.getElementById('history-list');

            if (history.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            list.innerHTML = history.map(h => `
                <li class="history-item">
                    <span>${h.inv} faktur (${h.time})</span>
                    <strong>${h.savings}</strong>
                </li>
            `).join('');
        }

        function clearHistory() {
            storage.remove('ksef_roi_history');
            renderHistory();
            trackEvent('history_cleared');
        }

        // --- UI ACTIONS ---
        function setPreset(type) {
            const sBtn = document.getElementById('btn-small');
            const cBtn = document.getElementById('btn-corp');

            if (type === 'small') {
                document.getElementById('invoices').value = 150;
                document.getElementById('cost-per-hour').value = 80;
                document.getElementById('manual-time').value = 12;
                sBtn.classList.add('active');
                cBtn.classList.remove('active');
            } else {
                document.getElementById('invoices').value = 1200;
                document.getElementById('cost-per-hour').value = 120;
                document.getElementById('manual-time').value = 15;
                cBtn.classList.add('active');
                sBtn.classList.remove('active');
            }
            calculate();
            trackEvent('preset_changed', { type });
        }

        const modal = document.getElementById("privacyModal");
        function openModal() { modal.style.display = "flex"; trackEvent('privacy_view'); }
        function closeModal() { modal.style.display = "none"; }
        window.onclick = (e) => { if (e.target == modal) closeModal(); }

        const roiForm = document.getElementById('roi-form');
        roiForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('btn-pdf');
            const formData = new FormData(roiForm);

            btn.disabled = true;
            btn.innerText = "Trwa wysy≈Çka...";
            showFeedback("Generujemy Tw√≥j raport...", "blue");

            try {
                const response = await fetch("/", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams(formData).toString(),
                });
                if (response.ok) {
                    showFeedback("‚úÖ Sukces! Sprawd≈∫ sw√≥j e-mail.", "green");
                    btn.innerText = "Wys≈Çano pomy≈õlnie";
                    trackEvent('form_lead_success');
                } else { throw new Error(); }
            } catch (err) {
                showFeedback("‚ùå B≈ÇƒÖd wysy≈Çki. Spr√≥buj za chwilƒô.", "red");
                btn.disabled = false;
                btn.innerText = "Spr√≥buj ponownie";
                trackEvent('form_lead_error');
            }
        });

        function handleOrder() {
            trackEvent('cta_order_clicked');
            document.getElementById('kontakt-section').scrollIntoView({ behavior: 'smooth' });
        }

        function showFeedback(msg, color) {
            const f = document.getElementById('feedback-msg');
            f.innerText = msg;
            f.style.color = color === 'red' ? 'var(--error)' : color === 'green' ? 'var(--green-primary)' : 'var(--blue-light)';
        }

        window.onload = () => {
            setPreset('small');
            renderHistory();
            trackEvent('app_loaded');
        };
    </script>
</body>

</html>
